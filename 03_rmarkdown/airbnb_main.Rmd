---
title: "airbnb in New York City"
author: "Carole Mattmann und Jonas Zuercher"
date: "13 Februar 2020"
output:
  pdf_document: default
  html_document: default
  word_document: default
---

```{r setup, include=FALSE, echo=TRUE, eval = TRUE}

```

Included packages: 

```{r packages, include=TRUE, echo=TRUE, eval = TRUE, message=FALSE, warning=FALSE}
library(dplyr)
library(tidyverse)
library(geosphere)
library(ggplot2)
```

## Introduction
We are exploring a dataset of airbnb listings in New York City in 2019.

```{r import, eval=TRUE, echo=TRUE, include=TRUE}
AB_NYC <- read.csv("../01_data/AB_NYC_2019.csv", header=TRUE)
str(AB_NYC)
```

## Data cleaning

Following changes have been made to the dataset:

### remove price 0

remove all listings with price 0

```{r price0, include=TRUE, echo=TRUE, eval = TRUE}
AB_NYC <-AB_NYC[AB_NYC$price > 0,]
```

### add log price

add logarithmic price for analysis purposes 
```{r pricelog, include=TRUE, echo=TRUE, eval = TRUE}
AB_NYC <- cbind(AB_NYC,price_log = log(AB_NYC$price))
```

### remove inactive listings

remove inactive listings and make new dataset to compare to full dataset

```{r removeinactive, include=TRUE, echo=TRUE, eval = TRUE}
AB_NYC_available <- AB_NYC %>% 
  filter(availability_365 > 0) 
```

### add distance to Times Square to model

We want to make a statement about how central the place is. Therefore the distance to Times Square is caculated using the latitude and longitude of the listings. The package "geosphere" is used.

Times Square, Manhattan, NY, USA, Latitude and longitude coordinates are: 40.758896, -73.98513

```{r distance_timessquare, include=TRUE, echo=TRUE, eval = TRUE}

coord <- cbind(AB_NYC$longitude,AB_NYC$latitude)
dist.timessquare <- distGeo(p1=coord, p2=c(-73.985130, 40.758896))
AB_NYC <- cbind(AB_NYC,dist.timessquare)
```

### Create subsets for room type

```{r room_subsets, include=TRUE, echo=TRUE, eval = TRUE}

AB_NYC_entirehome <-AB_NYC[AB_NYC$room_type == "Entire home/apt",]

AB_NYC_privateroom <-AB_NYC[AB_NYC$room_type == "Private room",]

AB_NYC_sharedroom <-AB_NYC[AB_NYC$room_type == "Shared room",]
```


## Data visualisation


```{r plot1, include=TRUE, echo=TRUE, eval = TRUE}

ggplot(data = AB_NYC,
       mapping = aes(y = price_log,
                     x = "",
                     group = neighbourhood_group,
                     colour = neighbourhood_group)) +
  geom_boxplot() +
  facet_wrap(. ~ room_type)+
  xlab("")+
  ylab("log (price in $ per night)")


```

### ?
```{r plots, include=TRUE, echo=TRUE, eval = TRUE}

## price distribution
ggplot(data = AB_NYC,
       mapping = aes(x = price_log,
                     group = room_type,
                     colour = room_type,
                     fill = room_type,
                     alpha = 0.5)) +
  geom_density() +
  xlab("log (price in $ per night)")+
  ylab("density ")

## availability distribution without 0
ggplot(data = AB_NYC_available,
       mapping = aes(x = availability_365)) +
  geom_histogram() +
  xlab("availability")+
  ylab("density ")
```

## Possible models to calculate the price of an airbnb



```{r lm, include=TRUE, echo=TRUE, eval = TRUE}
##simple linear models

lm.hood <- lm (data=AB_NYC, price_log~neighbourhood_group)
summary(lm.hood)

lm.type <- lm (data=AB_NYC, price_log~room_type)
summary(lm.type)

lm.dist <- lm (data=AB_NYC, price_log~dist.timessquare)
summary(lm.dist)

#distance and room type on price (with interaction)

lm.dist.type.interact <- lm (data=AB_NYC, price~dist.timessquare*room_type)
summary(lm.dist.type.interact)

ggplot(data = AB_NYC,
       mapping = aes(y = price,
                     x = dist.timessquare,
                     colour = room_type,
                     group = room_type)) +
  geom_point(alpha = 0.03) +
  xlab("distance to timessquare in m")+
  ylab("price in $ per night")+
  ylim(0,300)+
  geom_smooth(method="lm")
```

```{r lm2, include=TRUE, echo=TRUE, eval = TRUE}
#multiple linear regression

lm.full <- lm (data=AB_NYC, price_log~room_type+neighbourhood_group+minimum_nights+number_of_reviews+calculated_host_listings_count+availability_365+dist.timessquare)
summary(lm.full)

lm.empty <- lm (data=AB_NYC, price_log~NULL)
add1(lm.empty,scope=lm.full)

#choose value with smallest RSS

lm.1 <- update(lm.empty,.~.+room_type) 
add1(lm.1,scope=lm.full)

lm.2 <- update(lm.1,.~.+dist.timessquare)
add1(lm.2,scope=lm.full)

lm.3 <- update(lm.2,.~.+availability_365)
add1(lm.3,scope=lm.full)

lm.4 <- update(lm.3,.~.+neighbourhood_group)
add1(lm.4,scope=lm.full)

lm.5 <- update(lm.4,.~.+minimum_nights)
add1(lm.5,scope=lm.full)

summary(lm.5)
```

```{r lm3, include=TRUE, echo=TRUE, eval = TRUE}
lm.full2 <- lm (data=AB_NYC_entirehome, price_log~neighbourhood_group+minimum_nights+number_of_reviews+calculated_host_listings_count+availability_365+dist.timessquare)
summary(lm.full2)

lm.full3 <- lm (data=AB_NYC_privateroom, price_log~neighbourhood_group+minimum_nights+number_of_reviews+calculated_host_listings_count+availability_365+dist.timessquare)
summary(lm.full3)

lm.full4 <- lm (data=AB_NYC_sharedroom, price_log~neighbourhood_group+minimum_nights+number_of_reviews+calculated_host_listings_count+availability_365+dist.timessquare)
summary(lm.full4)
```



## Interactive map with the leaflet package











