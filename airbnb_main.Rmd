---
title: "airbnb in New York City"
author: "Carole Mattmann und Jonas Zuercher"
date: "13 Februar 2020"
output:
  pdf_document: default
  html_document: default
  word_document: default
---


```{r setup, include=FALSE, echo=TRUE, eval = TRUE}

```

Included packages: 

```{r packages, include=TRUE, echo=TRUE, eval = TRUE, message=FALSE, warning=FALSE}
library(dplyr)
library(tidyverse)
library(geosphere)
library(ggplot2)
```

# Introduction
We are exploring a dataset of airbnb listings in New York City in 2019.

```{r import, eval=, echo=TRUE, include=TRUE}
AB_NYC <- read.csv("../01_data/AB_NYC_2019.csv", header=TRUE)
str(AB_NYC)

```

# Data cleaning
## Data import and preparation of the Airbnb Dataset
Following changes have been made to the dataset:

### remove price 0

remove all listings with price 0

```{r price0, include=TRUE, echo=TRUE, eval = TRUE}
AB_NYC <-AB_NYC[AB_NYC$price > 0,]
```

### add log price

add logarithmic price for analysis purposes 
```{r pricelog, include=TRUE, echo=TRUE, eval = TRUE}
AB_NYC <- cbind(AB_NYC,price_log = log(AB_NYC$price))
```

### remove inactive listings

remove inactive listings and make new dataset to compare to full dataset

```{r removeinactive, include=TRUE, echo=TRUE, eval = TRUE}
AB_NYC_available <- AB_NYC %>% 
  filter(availability_365 > 0) 
```

### add distance to Times Square to model

We want to make a statement about how central the place is. Therefore the distance to Times Square is caculated using the latitude and longitude of the listings. The package "geosphere" is used.

Times Square, Manhattan, NY, USA, Latitude and longitude coordinates are: 40.758896, -73.98513

```{r distance_timessquare, include=TRUE, echo=TRUE, eval = TRUE}

coord <- cbind(AB_NYC_available$longitude,AB_NYC_available$latitude)
dist.timessquare <- distGeo(p1=coord, p2=c(-73.985130, 40.758896))
AB_NYC_available <- cbind(AB_NYC_available,dist.timessquare)
```

### Create subsets for room type

```{r room_subsets, include=TRUE, echo=TRUE, eval = TRUE}

AB_NYC_entirehome <-AB_NYC_available[AB_NYC_available$room_type == "Entire home/apt",]

AB_NYC_privateroom <-AB_NYC_available[AB_NYC_available$room_type == "Private room",]

AB_NYC_sharedroom <-AB_NYC_available[AB_NYC_available$room_type == "Shared room",]
```

### Prepare dataset for merging
```{r echo=TRUE}
# Neighbourhood Group klein schreiben für Merging
AB_NYC_available$neighbourhood_group<-tolower(AB_NYC_available$neighbourhood_group)

#Leerzeichen aus den Distrikten entfernen
AB_NYC_available$neighbourhood_group <-gsub(" ","", AB_NYC_available$neighbourhood_group)

# Neighbourhood Group als Faktor
AB_NYC_available$neighbourhood_group<-factor(AB_NYC_available$neighbourhood_group)
```

## Data import and preparation of the Airbnb Dataset
Das Dataset wurde auf folgender URL heruntergeladen: https://data.cityofnewyork.us/City-Government/Agency-Performance-Mapping-Indicators-Annual/gsj6-6rwm 

```{r}
Ind_NYC<- read.csv("C:/Users/jonas/Studium HSLU/Module/R-Bootcamp/Project/Indicators_NYC.csv")
head(Ind_NYC)

#Nur noch Daten von 2019
Ind_NYC_2019<-data.frame("neighbourhood_group2"= Ind_NYC$Geographic.Identifier, "Indicator"=Ind_NYC$Indicator,"Incidents"=Ind_NYC$FY2019)
head(Ind_NYC_2019)
Ind_NYC_2019_cleaned<-Ind_NYC_2019


#Nummern aus den Distrikten entfernen
Ind_NYC_2019_cleaned$neighbourhood_group <-gsub("[0-9]","", Ind_NYC_2019_cleaned$neighbourhood_group2 )
#Leerzeichen aus den Distrikten entfernen
Ind_NYC_2019_cleaned$neighbourhood_group <-gsub(" ","", Ind_NYC_2019_cleaned$neighbourhood_group )
#Alle distrikte klein schreiben
Ind_NYC_2019_cleaned$neighbourhood_group<-tolower(Ind_NYC_2019_cleaned$neighbourhood_group)
# Neighbourhood Group als Faktor
Ind_NYC_2019_cleaned$neighbourhood_group<-factor(Ind_NYC_2019_cleaned$neighbourhood_group)

#Überblick
head(Ind_NYC_2019_cleaned$Incidents)  
head(Ind_NYC_2019_cleaned$neighbourhood_group)
summary(Ind_NYC_2019_cleaned)
summary(Ind_NYC_2019_cleaned$Indicator)
levels(Ind_NYC_2019_cleaned$neighbourhood_group)

# Summe der Incidents pro Distrikt und Indikator
Summary_Ind_NYC_2019<-Ind_NYC_2019_cleaned %>%
  group_by(neighbourhood_group=Ind_NYC_2019_cleaned$neighbourhood_group,Indicator) %>%
  summarise(Observations=sum(Incidents,na.rm = TRUE))
summary(Summary_Ind_NYC_2019)


# Angaben ohne Distrikt werte entfernen
Summary_Ind_NYC_2019<-filter(Summary_Ind_NYC_2019,neighbourhood_group != "")
summary(Summary_Ind_NYC_2019)
head(Summary_Ind_NYC_2019)

# Indikator verschachteln
NYC_nest<-Summary_Ind_NYC_2019 %>%
  nest(Indicator=c(Indicator, Observations))
head(NYC_nest)
```
```{r}
#Join both datasets
NYC<-left_join(AB_NYC_available,NYC_nest, by="neighbourhood_group")

# Neighbourhood Group als Faktor
NYC$neighbourhood_group<-factor(NYC$neighbourhood_group)
```


## Data visualisation

### Distribution of prices by room types and neighbourhood

```{r plot1, include=TRUE, echo=TRUE, eval = TRUE}

ggplot(data = AB_NYC,
       mapping = aes(y = price_log,
                     x = "",
                     group = neighbourhood_group,
                     colour = neighbourhood_group)) +
  geom_boxplot() +
  facet_wrap(. ~ room_type)+
  xlab("")+
  ylab("log (price in $ per night)")


```

### ?
```{r plots, include=TRUE, echo=TRUE, eval = TRUE}

## price distribution
ggplot(data = AB_NYC,
       mapping = aes(x = price_log,
                     group = room_type,
                     colour = room_type,
                     fill = room_type,
                     alpha = 0.5)) +
  geom_density() +
  xlab("log (price in $ per night)")+
  ylab("density ")

## availability distribution without 0
ggplot(data = AB_NYC_available,
       mapping = aes(x = availability_365)) +
  geom_histogram() +
  xlab("availability")+
  ylab("density ")
```

## Possible models to calculate the price of an airbnb

```{r child = "linear models.rmd""}

```

## Interactive map with the leaflet package

```{r}
df_exp<-filter(NYC,price == max(price))
df_cheap<-filter(NYC,price == min(price))
```






This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.





